<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EarnEXM Pro - InisTa Edition</title>
    <style>
        :root { --y: #ffcc00; --p: #ff00ff; --b: #0088ff; --dark: #050505; }
        body { margin: 0; background: #000b21; color: white; font-family: 'Arial', sans-serif; height: 100vh; overflow: hidden; }

        /* Stats Bar */
        .top-bar { display: flex; justify-content: space-between; padding: 15px; background: rgba(0,0,0,0.8); border-bottom: 2px solid #111; z-index: 100; position: relative; }
        .stat { background: #111; padding: 5px 15px; border-radius: 20px; border: 1px solid #333; font-weight: bold; font-size: 0.9rem; }

        /* Game Layout */
        .game-wrapper { position: relative; height: calc(100vh - 140px); display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 20px; }

        /* Side Icons - Fixed & Working */
        .side-icons { position: absolute; width: 100%; top: 40%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; z-index: 50; }
        .circle-btn { width: 65px; height: 65px; background: var(--y); border: 4px solid #000; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 5px 0 #000; transition: 0.1s; }
        .circle-btn:active { transform: translateY(4px); box-shadow: none; }
        .circle-btn span { font-size: 0.55rem; color: #000; font-weight: 900; margin-top: 2px; }

        /* HUGE HALF WHEEL - The Core Request */
        .wheel-box { position: absolute; bottom: -280px; width: 600px; height: 600px; z-index: 10; }
        canvas { width: 100%; height: 100%; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }
        .pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 35px solid #ff0000; z-index: 100; filter: drop-shadow(0 0 10px rgba(255,0,0,0.5)); }

        /* Spin Button Area */
        .action-area { position: absolute; bottom: 100px; z-index: 60; }
        .spin-btn { background: linear-gradient(#ffea00, #ffaa00); border: none; padding: 15px 50px; border-radius: 50px; font-size: 1.3rem; font-weight: 900; border-bottom: 6px solid #885500; cursor: pointer; color: #000; }
        .spin-btn:disabled { background: #555; border-bottom: 4px solid #222; color: #888; cursor: not-allowed; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #000; height: 70px; display: flex; justify-content: space-around; align-items: center; border-top: 2px solid #222; z-index: 200; }
        .nav-link { text-align: center; color: #888; font-size: 0.7rem; font-weight: bold; cursor: pointer; flex: 1; }
        .nav-link.active { color: var(--y); }

        /* Screens */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
        .card { background: #0a0a0a; border: 2px solid var(--y); border-radius: 20px; padding: 25px; width: 100%; max-width: 350px; text-align: center; }
        .hidden { display: none !important; }

        #toast { visibility: hidden; min-width: 200px; background: var(--y); color: #000; padding: 15px; border-radius: 10px; position: fixed; left: 50%; bottom: 90px; transform: translateX(-50%); z-index: 5000; font-weight: bold; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 90px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 90px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

    <div id="toast">Message</div>

    <div class="top-bar">
        <div class="stat">ü™ô <span id="e-val">0</span></div>
        <div class="stat" style="color:lime">üíµ <span id="u-val">0.0000</span></div>
        <button style="background:red; color:white; border:none; border-radius:5px;" onclick="window.close()">EXIT</button>
    </div>

    <div class="game-wrapper">
        <div class="side-icons">
            <div class="circle-btn" onclick="v('scr-lucky')">üèÜ<span>LUCKY</span></div>
            <div class="circle-btn" onclick="v('scr-admin')">‚öôÔ∏è<span>ADMIN</span></div>
        </div>

        <div class="action-area">
            <button id="spin-btn" class="spin-btn" onclick="handleSpin()">SPIN NOW</button>
        </div>

        <div class="wheel-box">
            <div class="pointer"></div>
            <canvas id="wheel" width="600" height="600"></canvas>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-link" onclick="v('scr-invite')">üë•<br>INVITE</div>
        <div class="nav-link active" onclick="goHome()">üé°<br>SPIN</div>
        <div class="nav-link" onclick="v('scr-earn')">üöÄ<br>EARN</div>
        <div class="nav-link" onclick="v('scr-withdraw')">üè¶<br>WALLET</div>
        <div class="nav-link" onclick="v('scr-profile')">üë§<br>PROFILE</div>
    </div>

    <div id="scr-profile" class="overlay hidden">
        <div class="card">
            <h3>MY PROFILE</h3>
            <p>NAME: <span id="p-name" style="color:var(--y)"></span></p>
            <p>USER ID: <span id="p-id" style="color:var(--y)"></span></p>
            <p>EMAIL: <span style="color:var(--y)">earnexmads@gmail.com</span></p>
            <button class="spin-btn" style="padding:10px 20px; font-size:0.8rem;" onclick="copyID()">COPY ID</button>
        </div>
        <p onclick="goHome()" style="margin-top:20px; cursor:pointer;">Back</p>
    </div>

    <div id="scr-earn" class="overlay hidden">
        <div class="card" style="border-color:var(--b)">
            <h2 style="color:var(--b)">DAILY TASK</h2>
            <p>Visit link for 25s to earn 10 EXM</p>
            <div id="timer-ui" class="hidden" style="font-size:3rem; color:var(--b); margin:15px;">25s</div>
            <button id="take-btn" class="spin-btn" style="background:var(--b); color:white; border-color:#004488;" onclick="startTask()">TAKE IT</button>
            <div id="claim-ui" class="hidden">
                <button class="spin-btn" style="background:lime; border-color:green;" onclick="claimTask()">CLAIM 10 EXM</button>
            </div>
        </div>
        <p onclick="goHome()" id="task-close" style="margin-top:20px; cursor:pointer;">Close</p>
    </div>

    <div id="scr-lucky" class="overlay hidden">
        <div class="card">
            <h2 style="color:var(--p)">LUCKY DRAW</h2>
            <p>Win 10,000 EXM Weekly!</p>
            <button class="spin-btn" style="background:var(--p); color:white; border-color:#880088;" onclick="window.open('https://otieu.com/4/10493012')">ENTER NOW</button>
        </div>
        <p onclick="goHome()" style="margin-top:20px; cursor:pointer;">Back</p>
    </div>

    <div id="scr-admin" class="overlay hidden">
        <div class="card">
            <h3>ADMIN LOGIN</h3>
            <input type="password" id="adm-pass" placeholder="Pass" style="width:100%; padding:10px; margin-bottom:10px;">
            <button class="spin-btn" onclick="adminAuth()">LOGIN</button>
            <div id="adm-panel" class="hidden">
                <input type="text" id="target-id" placeholder="User ID" style="width:100%; margin-top:10px;">
                <button onclick="doRecycle()" style="background:red; color:white; width:100%; margin-top:10px;">RECYCLE</button>
            </div>
        </div>
        <p onclick="goHome()" style="margin-top:20px; cursor:pointer;">Back</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const config = { apiKey: "AIzaSyD3xCKkyQT-6FOURJBjBaTNKOFItL2M87Q", authDomain: "earnexmapp-8a0a2.firebaseapp.com", projectId: "earnexmapp-8a0a2", databaseURL: "https://earnexmapp-8a0a2-default-rtdb.firebaseio.com", appId: "1:325148626791:web:0448e65046bb38e365e9c2" };
        const app = initializeApp(config); const db = getDatabase(app);

        let fid = localStorage.getItem('exm_id_v2') || Math.floor(10000000 + Math.random() * 89999999).toString();
        let fname = localStorage.getItem('exm_name_v2') || "USER_" + Math.random().toString(36).substring(2,7).toUpperCase();
        localStorage.setItem('exm_id_v2', fid); localStorage.setItem('exm_name_v2', fname);
        
        document.getElementById('p-id').innerText = fid; document.getElementById('p-name').innerText = fname;
        const userRef = ref(db, 'users/' + fid);

        const canvas = document.getElementById('wheel'); const ctx = canvas.getContext('2d');
        const items = ["10", "20", "50", "0", "15", "5", "100", "0"];
        
        function draw() {
            const arc = (Math.PI*2)/8;
            for(let i=0; i<8; i++) {
                ctx.fillStyle = i%2==0 ? "#ffcc00" : "#ff00ff";
                ctx.beginPath(); ctx.arc(300, 300, 280, i*arc, (i+1)*arc); ctx.lineTo(300, 300); ctx.fill();
                ctx.save(); ctx.fillStyle = "black"; ctx.font = "bold 24px Arial"; ctx.translate(300, 300); ctx.rotate(i*arc + arc/2); ctx.fillText(items[i], 180, 10); ctx.restore();
            }
        }
        draw();

        let isSpinning = false;
        window.handleSpin = async () => {
            if(isSpinning) return;
            const snap = await get(userRef);
            let bal = snap.val()?.exm || 500;
            if(bal < 10) { showToast("Need 10 EXM!"); return; }

            isSpinning = true;
            document.getElementById('spin-btn').disabled = true;
            update(userRef, {exm: bal - 10});

            const rot = 3600 + Math.floor(Math.random()*360);
            canvas.style.transform = `rotate(${rot}deg)`;

            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spin-btn').disabled = false;
                update(userRef, {exm: parseInt(document.getElementById('e-val').innerText) + 15});
                showToast("WIN! +15 EXM Added");
            }, 4000);
        };

        window.v = (id) => { document.querySelectorAll('.overlay').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); };
        window.goHome = () => { document.querySelectorAll('.overlay').forEach(s => s.classList.add('hidden')); };
        window.showToast = (m) => { const t = document.getElementById('toast'); t.innerText=m; t.className="show"; setTimeout(()=>t.className="", 3000); };

        window.startTask = () => {
            window.open("https://otieu.com/4/10493012", "_blank");
            document.getElementById('take-btn').classList.add('hidden');
            document.getElementById('task-close').classList.add('hidden');
            const timerUI = document.getElementById('timer-ui'); timerUI.classList.remove('hidden');
            let time = 25;
            const itv = setInterval(() => {
                time--; timerUI.innerText = time+"s";
                if(time <= 0) { clearInterval(itv); timerUI.classList.add('hidden'); document.getElementById('claim-ui').classList.remove('hidden'); }
            }, 1000);
        };

        window.claimTask = async () => {
            const snap = await get(userRef);
            update(userRef, {exm: (snap.val()?.exm || 0) + 10});
            showToast("üí∞ +10 EXM!");
            location.reload();
        };

        window.adminAuth = () => { if(document.getElementById('adm-pass').value === "InisTa") document.getElementById('adm-panel').classList.remove('hidden'); };
        window.copyID = () => { navigator.clipboard.writeText(fid); showToast("ID Copied!"); };

        onValue(userRef, (s) => {
            const d = s.val() || {exm: 500};
            document.getElementById('e-val').innerText = d.exm;
            document.getElementById('u-val').innerText = (d.exm * 0.0005).toFixed(4);
        });
    </script>
</body>
</html>
